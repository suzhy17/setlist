<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="AUTH">

	<!-- 고객사 정보 조회 -->
	<select id="selectCompany" parameterType="map" resultType="company">
		SELECT *
		FROM  ems_company
		WHERE use_yn = 'Y'
		<if test="companyNo != null and companyNo != ''">
		AND   company_no = #{companyNo}
		</if>
		<if test="companyId != null and companyId != ''">
		AND   company_id = #{companyId}
		</if>
	</select>
	
	<!-- 사용자 정보 조회 -->
	<select id="selectUser" parameterType="map" resultType="user">
		SELECT *
		FROM  ems_user
		WHERE company_no = #{companyNo}
		AND   user_id    = #{userId}
	</select>

	<!-- 사용자 등록 -->
	<insert id="insertUser" parameterType="user">
		INSERT INTO ems_user (
		      user_id
		    , company_no
		    , reg_dt
		    , last_login_dt
		) VALUES (
		      #{userId}
		    , #{companyNo}
		    , NOW()
		    , NOW()
		)
		<selectKey keyProperty="userNo" keyColumn="user_no" resultType="integer">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<!-- 사용자의 마지막 로그인 일시 업데이트 -->
	<update id="updateUserForLastLoginDt" parameterType="user">
		UPDATE ems_user
		SET   last_login_dt = NOW()
		WHERE company_no = #{companyNo}
		AND   user_id    = #{userId} 
	</update>
</mapper>